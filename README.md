
# Table of Contents

1.  [Overview](#orgbbe61e8)
2.  [How to add locally](#org3c88c16)
3.  [How to use](#org2f12eef)
4.  [Using virtual run env](#orgc24a5d3)


<a id="orgbbe61e8"></a>

# Overview

This is a conan configuration to add babelc as a conan package.

`babelc` is a tool for using C++ declarations as

-   an IDL for D-Bus
-   a schema for JSON

It can also generate standard text stream input and output
operators for user defined data types and containers thereof.

The babelc tool itself is GPLv2 but the code generated by it is either
totally license free or MIT licensed (in the case of the JSON DOM
parser).

more can be found [here](http://babelc.com).


<a id="org3c88c16"></a>

# How to add locally

Use the [conan create](https://docs.conan.io/en/latest/reference/commands/creator/create.html) command from the directory where `conanfile.py` in this repository
is located.

    conan create . 

This will download and build the `babelc` executable
To make sure everything is installed correctly do a local search

    conan search "babelc*"

    Existing package recipes:
    
    babelc/0.8.37


<a id="org2f12eef"></a>

# How to use

Lets say you want to use the `babelc` executable to generate .eg dbus interface.

first create a [conan file](https://docs.conan.io/en/latest/reference/conanfile_txt.html) to add the requirement of which babelc
version.

e.g

    cat<<EOF > /tmp/babelc/conanfile.txt
    [generators]
    cmake
    
    [requires]
    babelc/0.8.37
    
    [options]
    
    [imports]
    
    EOF
    
    mkdir -p babelc_gen && cd babelc_gen

At this point its time to execute  [conan install](https://docs.conan.io/en/latest/reference/commands/consumer/install.html) to install the babelc binary.
There is a `deploy` generator to be used, which installs the binary and the 
user manual in `babelc/bin/` directory. The above also uses cmake, so 
that babelc executable can be run from within cmake.

    conan install ../conanfile.txt --build=babelc  -g deploy

    .
    .
    .
    .
    babelc/0.8.37: Package '0ac8c9952b8651eefe078adcd928017cea3e0340' built
    babelc/0.8.37: Build folder /home/<user>/.conan/data/babelc/0.8.37/_/_/build/0ac8c9952b8651eefe078adcd928017cea3e0340
    babelc/0.8.37: Generated conaninfo.txt
    babelc/0.8.37: Generated conanbuildinfo.txt
    babelc/0.8.37: Generating the package
    babelc/0.8.37: Package folder /home/<user>/.conan/data/babelc/0.8.37/_/_/package/0ac8c9952b8651eefe078adcd928017cea3e0340
    babelc/0.8.37: Calling package()
    babelc/0.8.37 package(): Packaged 1 file: babelc
    babelc/0.8.37 package(): Packaged 1 '.pdf' file: UG-babelc.pdf
    babelc/0.8.37: Package '0ac8c9952b8651eefe078adcd928017cea3e0340' created
    babelc/0.8.37: Created package revision f3769e86a041895fbbcd40449650a0a5
    conanfile.txt: Generator deploy created deploy_manifest.txt
    conanfile.txt: Generator txt created conanbuildinfo.txt
    conanfile.txt: Generator cmake created conanbuildinfo.cmake
    conanfile.txt: Generated conaninfo.txt
    conanfile.txt: Generated graphinfo

here are the deploy directory

    ls /tmp/babelc/babelc_gen
    echo "----------deploy----------"
    tree ls /tmp/babelc/babelc_gen/babelc

    babelc
    conanbuildinfo.cmake
    conanbuildinfo.txt
    conaninfo.txt
    conan.lock
    deploy_manifest.txt
    graph_info.json
    ----------deploy----------
    ls [error opening dir]
    /tmp/babelc/babelc_gen/babelc
    └── bin
        ├── babelc
        └── UG-babelc.pdf
    
    1 directory, 2 files


<a id="orgc24a5d3"></a>

# Using virtual run env

Another way is to use the `virtualrunenv`

    conan install ../conanfile.txt --build=babelc -g virtualrunenv

    Requirements                                                                                                               
      babelc/0.8.37 from local cache - Cache                                                                                 
    Packages                                                                                                                   
      babelc/0.8.37:82ef5eac51c38971dea2fd342dd55ddf2ddfbbc3 - Build 
    .
    .
    .
    
    conanfile.txt: Generator cmake created conanbuildinfo.cmake
    conanfile.txt: Generator virtualrunenv created activate_run.ps1
    conanfile.txt: Generator virtualrunenv created deactivate_run.ps1
    conanfile.txt: Generator virtualrunenv created environment_run.ps1.env
    conanfile.txt: Generator virtualrunenv created activate_run.sh
    conanfile.txt: Generator virtualrunenv created deactivate_run.sh
    conanfile.txt: Generator virtualrunenv created environment_run.sh.env
    conanfile.txt: Generator txt created conanbuildinfo.txt
    conanfile.txt: Generated conaninfo.txt
    conanfile.txt: Generated graphinfo

and from here we can source the enviroment:

    source activate_run.sh
    babelc --help

    
    Usage: babelc <gcc-compiler-options|babelc-options> input-file
    
    where babelc options always starts with -babelc and can be:
    -babelcCompiler          Specify which GNU g++ compiler to use. Values are given
                             as -babelcCompiler=<value>, where <value> may be either
                             an absolute or relative path or pathless name (in which
                             case the environment variable PATH will be used).
                             Default is "g++".
    -babelcDirectory         Use this directory as output directory for generated
                             files. If this option is NOT given, the output file
                             will be put in the same directory as the originating
                             header. Values are given as -babelcDirectory=<value>,
                             where <value> may be either an existing or non-existing
                             directory (in case it will be created).
    -babelcForce             Force generation of output even if dependencies are
                             older than target output.
    -babelcKeepIntermediate  Keep intermediate preprocessed header file with new
                             extension ".ii". Non-standard name spaces will be saved
                             in files with the extension
                             ".namespace.<namespace-name>". Standard namespaces will
                             be saved in a file with extension ".namespace.0".
    -babelcLog               Print internal debug logs to standard output.
    -babelcNoColor           Disable the gcc coloring of diagnostic messages.
    -babelcOutput            Specify output generator. Values are given as
                             -babelcOutput=<value>, where <value> may be any one of
                             Dep, Ipc, Json, Stream.
    -babelcSummary           Print a summary of the findings in the submitted header
                             file on standard output.
    -babelcUnitTest          Run unit tests instead of the compiler proper. This
                             will not produce any output files. Test results will
                             appear on standard error and exit code is 0 if all
                             tests pass.
    -babelcUseTabs           Use hard tabs instead of soft tabs in generated code.

